<template>
  <v-card class="pa-5">
    <v-card class="mb-5 pa-3">
      <h1>Room: {{ roomId }}</h1>
      <h2>People :</h2>
      <WebRTC
        ref="webrtc"
        width="100%"
        roomId="roomId"
        @joined-room="logEvent"
        @left-room="logEvent"
        @opened-room="onOpen"
        @share-started="logEvent"
        @share-stopped="logEvent"
        @error="onError"
        stunServer="stun.l.google.com:19302"
        turnServer="YzYNCouZM1mhqhmseWk6@YzYNCouZM1mhqhmseWk6%turn:13.250.13.83:3478?transport=udp"
      />
    </v-card>
    <template v-for="(i,index) in actionBtn" >
      <v-btn :key="index" @click="i.func" class="mx-1">
        {{i.label}}
      </v-btn>
    </template>
    <img :src="img" class="img-responsive" />

    <chat-room />
  </v-card>
</template>

<script>
// import WebRTC from "vue-webrtc";
import WebRTC from '../components/WebRTC'
// ISSUE 5: https://github.com/westonsoftware/vue-webrtc/issues/5
import * as io from "socket.io-client";
import ChatRoom from './ChatRoom.vue';
window.io = io;
//
//
export default {
  name: "home",
  components : {
    WebRTC,
    ChatRoom
  },
  data() {
    return {
      img: "",
      roomId: "test",
      joinEnable: true,
      actionBtn : [
        {label : "Join room" , func : this.join},
        {label : "Share screen" , func : this.shareScreen},
      ]
    };
  },
  methods: {
    join() {
      this.joinEnable = false;
      this.$refs.webrtc.join();
      this.joinEnable = true;
    },
    shareScreen() {
      this.$refs.webrtc.shareScreen();
    },
    onOpen(e) {
      console.log("Open-Room : ", e);
    },
    logEvent(event) {
      console.log("Event : ", event);
    },
    onError(error, stream) {
      console.log("On Error Event", error, stream);
    },
    makeid(length) {
      var result = [];
      var characters =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      var charactersLength = characters.length;
      for (var i = 0; i < length; i++) {
        result.push(
          characters.charAt(Math.floor(Math.random() * charactersLength))
        );
      }
      return result.join("");
    },
  },
};
</script>

<style></style>
